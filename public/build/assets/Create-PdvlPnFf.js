import{x as Te,a as y,V as $e,b as Ce,j as e,M as Oe,r as i,U as Ae,c as ee}from"./app-BXjWVJEW.js";import{C as ke}from"./index-Ds7s4sY-.js";import{A as Be,B as Ie}from"./AuthenticatedLayout-BL0bFeEP.js";import{S as Pe}from"./react-select.esm-BpawOVWG.js";import{U as Ee}from"./UseAppUrl-SlSDkCPd.js";import{u as we}from"./useQuery-Coz9DPna.js";import{l as He}from"./index-DT19rGj8.js";import{f as Se}from"./format-BzRktsyD.js";var ae={exports:{}},Le=ae.exports,Me;function Fe(){return Me||(Me=1,function(ne,V){(function(T,F){ne.exports=F()})(Le,function(){var T=1e3,F=6e4,h=36e5,Q="millisecond",C="second",I="minute",l="hour",O="day",q="week",$="month",Z="quarter",M="year",P="date",X="Invalid Date",G=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,te=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,le={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var s=["th","st","nd","rd"],t=c%100;return"["+c+(s[(t-20)%10]||s[t]||s[0])+"]"}},R=function(c,s,t){var n=String(c);return!n||n.length>=s?c:""+Array(s+1-n.length).join(t)+c},ie={s:R,z:function(c){var s=-c.utcOffset(),t=Math.abs(s),n=Math.floor(t/60),r=t%60;return(s<=0?"+":"-")+R(n,2,"0")+":"+R(r,2,"0")},m:function c(s,t){if(s.date()<t.date())return-c(t,s);var n=12*(t.year()-s.year())+(t.month()-s.month()),r=s.clone().add(n,$),u=t-r<0,d=s.clone().add(n+(u?-1:1),$);return+(-(n+(t-r)/(u?r-d:d-r))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:$,y:M,w:q,d:O,D:P,h:l,m:I,s:C,ms:Q,Q:Z}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},D="en",E={};E[D]=le;var J="$isDayjsObject",U=function(c){return c instanceof H||!(!c||!c[J])},K=function c(s,t,n){var r;if(!s)return D;if(typeof s=="string"){var u=s.toLowerCase();E[u]&&(r=u),t&&(E[u]=t,r=u);var d=s.split("-");if(!r&&d.length>1)return c(d[0])}else{var x=s.name;E[x]=s,r=x}return!n&&r&&(D=r),r||!n&&D},g=function(c,s){if(U(c))return c.clone();var t=typeof s=="object"?s:{};return t.date=c,t.args=arguments,new H(t)},f=ie;f.l=K,f.i=U,f.w=function(c,s){return g(c,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var H=function(){function c(t){this.$L=K(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[J]=!0}var s=c.prototype;return s.parse=function(t){this.$d=function(n){var r=n.date,u=n.utc;if(r===null)return new Date(NaN);if(f.u(r))return new Date;if(r instanceof Date)return new Date(r);if(typeof r=="string"&&!/Z$/i.test(r)){var d=r.match(G);if(d){var x=d[2]-1||0,m=(d[7]||"0").substring(0,3);return u?new Date(Date.UTC(d[1],x,d[3]||1,d[4]||0,d[5]||0,d[6]||0,m)):new Date(d[1],x,d[3]||1,d[4]||0,d[5]||0,d[6]||0,m)}}return new Date(r)}(t),this.init()},s.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},s.$utils=function(){return f},s.isValid=function(){return this.$d.toString()!==X},s.isSame=function(t,n){var r=g(t);return this.startOf(n)<=r&&r<=this.endOf(n)},s.isAfter=function(t,n){return g(t)<this.startOf(n)},s.isBefore=function(t,n){return this.endOf(n)<g(t)},s.$g=function(t,n,r){return f.u(t)?this[n]:this.set(r,t)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(t,n){var r=this,u=!!f.u(n)||n,d=f.p(t),x=function(k,_){var S=f.w(r.$u?Date.UTC(r.$y,_,k):new Date(r.$y,_,k),r);return u?S:S.endOf(O)},m=function(k,_){return f.w(r.toDate()[k].apply(r.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(_)),r)},b=this.$W,j=this.$M,v=this.$D,W="set"+(this.$u?"UTC":"");switch(d){case M:return u?x(1,0):x(31,11);case $:return u?x(1,j):x(0,j+1);case q:var A=this.$locale().weekStart||0,z=(b<A?b+7:b)-A;return x(u?v-z:v+(6-z),j);case O:case P:return m(W+"Hours",0);case l:return m(W+"Minutes",1);case I:return m(W+"Seconds",2);case C:return m(W+"Milliseconds",3);default:return this.clone()}},s.endOf=function(t){return this.startOf(t,!1)},s.$set=function(t,n){var r,u=f.p(t),d="set"+(this.$u?"UTC":""),x=(r={},r[O]=d+"Date",r[P]=d+"Date",r[$]=d+"Month",r[M]=d+"FullYear",r[l]=d+"Hours",r[I]=d+"Minutes",r[C]=d+"Seconds",r[Q]=d+"Milliseconds",r)[u],m=u===O?this.$D+(n-this.$W):n;if(u===$||u===M){var b=this.clone().set(P,1);b.$d[x](m),b.init(),this.$d=b.set(P,Math.min(this.$D,b.daysInMonth())).$d}else x&&this.$d[x](m);return this.init(),this},s.set=function(t,n){return this.clone().$set(t,n)},s.get=function(t){return this[f.p(t)]()},s.add=function(t,n){var r,u=this;t=Number(t);var d=f.p(n),x=function(j){var v=g(u);return f.w(v.date(v.date()+Math.round(j*t)),u)};if(d===$)return this.set($,this.$M+t);if(d===M)return this.set(M,this.$y+t);if(d===O)return x(1);if(d===q)return x(7);var m=(r={},r[I]=F,r[l]=h,r[C]=T,r)[d]||1,b=this.$d.getTime()+t*m;return f.w(b,this)},s.subtract=function(t,n){return this.add(-1*t,n)},s.format=function(t){var n=this,r=this.$locale();if(!this.isValid())return r.invalidDate||X;var u=t||"YYYY-MM-DDTHH:mm:ssZ",d=f.z(this),x=this.$H,m=this.$m,b=this.$M,j=r.weekdays,v=r.months,W=r.meridiem,A=function(_,S,L,Y){return _&&(_[S]||_(n,u))||L[S].slice(0,Y)},z=function(_){return f.s(x%12||12,_,"0")},k=W||function(_,S,L){var Y=_<12?"AM":"PM";return L?Y.toLowerCase():Y};return u.replace(te,function(_,S){return S||function(L){switch(L){case"YY":return String(n.$y).slice(-2);case"YYYY":return f.s(n.$y,4,"0");case"M":return b+1;case"MM":return f.s(b+1,2,"0");case"MMM":return A(r.monthsShort,b,v,3);case"MMMM":return A(v,b);case"D":return n.$D;case"DD":return f.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return A(r.weekdaysMin,n.$W,j,2);case"ddd":return A(r.weekdaysShort,n.$W,j,3);case"dddd":return j[n.$W];case"H":return String(x);case"HH":return f.s(x,2,"0");case"h":return z(1);case"hh":return z(2);case"a":return k(x,m,!0);case"A":return k(x,m,!1);case"m":return String(m);case"mm":return f.s(m,2,"0");case"s":return String(n.$s);case"ss":return f.s(n.$s,2,"0");case"SSS":return f.s(n.$ms,3,"0");case"Z":return d}return null}(_)||d.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(t,n,r){var u,d=this,x=f.p(n),m=g(t),b=(m.utcOffset()-this.utcOffset())*F,j=this-m,v=function(){return f.m(d,m)};switch(x){case M:u=v()/12;break;case $:u=v();break;case Z:u=v()/3;break;case q:u=(j-b)/6048e5;break;case O:u=(j-b)/864e5;break;case l:u=j/h;break;case I:u=j/F;break;case C:u=j/T;break;default:u=j}return r?u:f.a(u)},s.daysInMonth=function(){return this.endOf($).$D},s.$locale=function(){return E[this.$L]},s.locale=function(t,n){if(!t)return this.$L;var r=this.clone(),u=K(t,n,!0);return u&&(r.$L=u),r},s.clone=function(){return f.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},c}(),re=H.prototype;return g.prototype=re,[["$ms",Q],["$s",C],["$m",I],["$H",l],["$W",O],["$M",$],["$y",M],["$D",P]].forEach(function(c){re[c[1]]=function(s){return this.$g(s,c[0],c[1])}}),g.extend=function(c,s){return c.$i||(c(s,H,g),c.$i=!0),g},g.locale=K,g.isDayjs=U,g.unix=function(c){return g(1e3*c)},g.en=E[D],g.Ls=E,g.p={},g})}(ae)),ae.exports}var Ue=Fe();const We=Te(Ue),Ge=({collectors:ne})=>{var oe,de,ue,me,he,pe,be,fe,xe,ge,ye,je,_e,Ne,ve;const V=Ee(),[T,F]=y.useState(null),[h,Q]=y.useState({}),[C,I]=y.useState(""),[l,O]=y.useState(null);y.useState("");const[q,$]=y.useState(""),Z=y.useRef(),M=He.useReactToPrint({contentRef:Z}),P=async({queryKey:a})=>{const[o,p,w,B,N]=a;return(await ee.get(`${V}/api/customers/transactions`,{params:{page:p,search:w,sortColumn:B,sortDirection:N}})).data},X=async({queryKey:a})=>{const[o,p,w,B,N]=a;return N?(await ee.get(`${V}/api/customers/transactions`,{params:{page:p,search:N,sortColumn:w,sortDirection:B}})).data:{data:[],current_page:1}},{customers:G}=$e().props,[te,le]=y.useState(""),[R,ie]=y.useState((G==null?void 0:G.current_page)||1),[D,E]=y.useState({column:"",direction:"asc"}),{customer_transactions:J}=$e().props;y.useState(""),y.useState((J==null?void 0:J.current_page)||1),y.useState({column:"",direction:"asc"});const{data:U,error:K,isLoading:g,refetch:f}=we({queryKey:["customers",R,te,D.column,D.direction],queryFn:P,keepPreviousData:!0}),{data:H,isTransLoading:re,refetch:c}=we({queryKey:["customer-transactions",R,D.column,D.direction,T],queryFn:X,enabled:!!T,keepPreviousData:!0}),[s,t]=y.useState(!1),n=()=>t(!s),[r,u]=y.useState(!1),d=()=>{u(!r)},x=async()=>{try{const a=await ee.get(`${V}/api/transactions/generate-bill-no`);$(a.data.bill_no),b("bill_no",a.data.bill_no)}catch(a){console.error("Failed to fetch new bill number",a)}},{data:m,setData:b,post:j,errors:v,reset:W,processing:A}=Ce({customer_plan_id:"",collector_id:"",bill_no:q,rebate:"",partial:"",bill_amount:"",remarks:"",status:"",date_billing:""}),z=async a=>{a.preventDefault();const o=Number((h==null?void 0:h.plan_price)||0)-Number(m.rebate||0),p={...m,bill_amount:o,rebate:Number(m.rebate)||0,partial:Number(m.partial)||0};try{const B=(await ee.post(`${V}/api/transactions`,p)).data.transaction.id;window.open(`/transactions/print/${B}`,"_blank"),window.location.reload()}catch(w){console.error("Error creating transaction:",w.response||w),alert("Failed to create transaction. Check console for details.")}},k=["Month","Bill Noww.","Bill Amount","Status"],_=["Acc No.","Customer Name","Status"],S=[{value:"paid",label:"Paid"},{value:"unpaid",label:"Unpaid"}],L=(U==null?void 0:U.data.map(a=>({id:a.id,customer_name:`${a.lastname} ${a.firstname} ${a.middlename??""}`,firstname:a.firstname,middlename:a.middlename,lastname:a.lastname,address:a.address,contact_no:a.contact_no,sex:a.sex,marital_status:a.marital_status,birthdate:a.birthdate,occupation:a.occupation,status:a.status,plans:a.customer_plans.map(o=>{const p=o.transactions.length?[...o.transactions].sort((N,se)=>new Date(se.created_at)-new Date(N.created_at))[0]:null;let w=null,B=null;return p&&(w=Number(p.bill_amount)-Number(p.partial),B=We(p.created_at).format("MMMM")),{customer_plan_id:o.id,mbps:o.plan.mbps,plan_price:o.plan.plan_price,date_registration:o.date_registration,latest_balance:o.latest_balance,latest_balance_month:o.latest_balance_month,transactions:o.transactions.map(N=>({id:N.id,bill_no:N.bill_no,rebate:N.rebate,partial:N.partial,bill_amount:N.bill_amount,remarks:N.remarks,status:N.status,created_at:N.created_at})),last_transaction:p,balance:w,balanceMonth:B,collector_id:o.collector_id}})})))||[],Y=(H==null?void 0:H.data.map(a=>({id:a.id,customer_name:`${a.lastname} ${a.firstname} ${a.middlename??""}`,firstname:a.firstname,middlename:a.middlename,lastname:a.lastname,address:a.address,contact_no:a.contact_no,sex:a.sex,marital_status:a.marital_status,birthdate:a.birthdate,occupation:a.occupation,status:a.status,plans:a.customer_plans.map(o=>({customer_plan_id:o.id,collector_id:o.collector_id,mbps:o.plan.mbps,plan_price:o.plan.plan_price,date_registration:o.date_registration,transactions:o.transactions.map(p=>({id:p.id,bill_no:p.bill_no,rebate:Number(p.rebate)||0,partial:Number(p.partial)||0,bill_amount:Number(p.bill_amount)||0,remarks:p.remarks,status:p.status,created_at:p.created_at,updated_at:p.updated_at}))}))})))||[];y.useEffect(()=>{x()},[]),y.useEffect(()=>{T!==null&&alert(`Selected Customer: ${h.customer_name}`)},[T,h]),y.useEffect(()=>{h!=null&&h.customer_plan_id&&b("customer_plan_id",h.customer_plan_id),h!=null&&h.collector_id&&b("collector_id",h.collector_id)},[h]);const De=a=>{const o=a.plans[0]||{};F(a.id),b("customer_plan_id",o.customer_plan_id),b("collector_id",o.collector_id),Q({customer_name:`${a.firstname} ${a.lastname}`,customer_plan_id:o.customer_plan_id,mbps:o.mbps||"N/A",plan_price:o.plan_price||"N/A",date_registration:o.date_registration||"N/A",latest_balance:o.latest_balance||0,latest_balance_month:o.latest_balance_month||"N/A",collector_id:o.collector_id||""}),t(!1)},ce=a=>{const o=a.target.value;I(o),b("remarks",o)};return e.jsxs(Be,{children:[e.jsx(Oe,{title:"Create New Bill"}),e.jsxs("div",{className:"bg-white overflow-y-auto max-h-[590px] grid place-justify-center ",children:[e.jsxs("div",{className:"flex justify-between mt-5 mb-2 px-4",children:[e.jsxs("div",{className:"flex gap-10",children:[e.jsx(i.Radio,{name:"type",label:"Advance Billing",value:"advance",checked:C==="advance",onChange:ce}),e.jsx(i.Radio,{name:"type",label:"Batch Billing",value:"batch",checked:C==="batch",onChange:ce})]}),e.jsx(i.Tooltip,{content:"Back",children:e.jsx(Ae,{href:"/transactions",className:"hover:bg-gray-200 px-2 py-1 rounded",children:e.jsx(Ie,{className:"text-xl cursor-pointer"})})})]}),e.jsxs(i.Dialog,{open:r,handler:d,size:"lg",children:[e.jsx(i.DialogHeader,{children:"Billing Notice"}),e.jsx(i.DialogBody,{children:e.jsx("div",{className:"h-[480px] overflow-auto",children:e.jsxs("div",{ref:Z,className:"relative  p-6 rounded shadow",children:[e.jsx("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rotate-[-30deg]
                text-green-800 font-bold text-6xl border-2 border-green-800
  px-8 py-4 opacity-40 select-none pointer-events-none
                whitespace-nowrap inline-block`,children:"CFS NOTICE PAID"}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("img",{src:"/img/internet.png",alt:"CFS Logo",className:"w-16 h-16"}),e.jsxs("div",{className:"text-sm mt-1",children:["#2, Manguelod Bldg. National High Way",e.jsx("br",{}),"District II, Tumauini, Isabela",e.jsx("br",{}),"TIN: 295-973-965-001",e.jsx("br",{}),"CP#: 09453367030"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:l!=null&&l.customer?[(oe=l.customer)==null?void 0:oe.firstname,(de=l.customer)==null?void 0:de.middlename,(ue=l.customer)==null?void 0:ue.lastname].filter(Boolean).join(" "):""}),e.jsx("p",{children:(me=l==null?void 0:l.transaction)!=null&&me.created_at?Se(new Date(l.transaction.created_at),"MMMM dd, yyyy"):""})]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Acct. No:"}),e.jsx("span",{children:((pe=(he=l==null?void 0:l.transaction)==null?void 0:he.customer_plan)==null?void 0:pe.customer_id)??""})]}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{children:"Bill No."}),e.jsx("span",{children:((be=l==null?void 0:l.transaction)==null?void 0:be.bill_no)??""})]}),e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Bill for the month of August"}),e.jsxs("span",{children:["₱"," ",((fe=l==null?void 0:l.transaction)==null?void 0:fe.bill_amount)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rebate"}),e.jsxs("span",{children:["₱"," ",((xe=l==null?void 0:l.transaction)==null?void 0:xe.rebate)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Partial"}),e.jsxs("span",{children:["₱"," ",((ge=l==null?void 0:l.transaction)==null?void 0:ge.partial)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Outstanding Balance Previous Month"}),e.jsxs("span",{children:["₱"," ",(l==null?void 0:l.outstanding_balance)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between font-bold border-t border-gray-400 pt-2",children:[e.jsx("span",{children:"Amount Due:"}),e.jsxs("span",{children:["₱"," ",((ye=l==null?void 0:l.transaction)==null?void 0:ye.bill_amount)??"0.00"]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-4",children:[e.jsx("span",{children:"Prepared by: John"}),e.jsxs("span",{children:["Collector:"," ",l!=null&&l.customer?[(je=l.collector)==null?void 0:je.firstname,(_e=l.collector)==null?void 0:_e.middlename,(Ne=l.collector)==null?void 0:Ne.lastname].filter(Boolean).join(" "):""]}),e.jsxs("span",{children:["Date:"," ",(ve=l==null?void 0:l.transaction)!=null&&ve.created_at?Se(new Date(l.transaction.created_at),"MMMM dd, yyyy"):""]})]}),e.jsxs("div",{className:"border border-red-500 p-3 rounded text-sm bg-red-50 flex items-start gap-2",children:[e.jsx("div",{className:"text-red-600 font-bold",children:"⚠"}),e.jsxs("div",{children:[e.jsx("p",{children:"7 Days Notice: To avoid temporary disconnection kindly settle your bill within 7 days of the due date. For assistance or to make a payment please call:"}),e.jsx("p",{className:"font-bold",children:"CUSTOMER SERVICE NO: 09453367030"}),e.jsx("p",{className:"font-bold",children:"BILLING DEPT. CP NO: 09162832206"})]})]})]})})}),e.jsxs(i.DialogFooter,{children:[e.jsx(i.Button,{variant:"text",color:"red",onClick:d,className:"mr-2",children:"Cancel"}),e.jsx(i.Button,{variant:"gradient",color:"green",onClick:()=>M(),children:"Print"})]})]}),e.jsxs("div",{className:"flex justify-between items-center px-4",children:[e.jsxs("div",{className:"flex gap-6 px-4",children:[e.jsxs(i.Typography,{variant:"h6",color:"blue-gray",children:["ACC NO.:"," ",e.jsx("span",{className:"text-orange-900",children:T})]}),e.jsxs(i.Typography,{variant:"h6",color:"blue-gray",children:["CUSTOMER:"," ",e.jsxs("span",{className:"text-orange-900",children:[(h==null?void 0:h.customer_name)||"","-- ",(h==null?void 0:h.collector_id)||""]})]}),e.jsxs(i.Typography,{variant:"h6",color:"blue-gray",children:["PLAN:"," ",e.jsx("span",{className:"text-orange-900",children:h&&h.mbps?`${h.mbps} mbps - ${new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(h.plan_price)}`:""})]}),e.jsxs(i.Typography,{variant:"h6",color:"blue-gray",children:["REGISTRATION:"," ",e.jsx("span",{className:"text-orange-900",children:h.date_registration})]}),e.jsxs(i.Typography,{variant:"h6",color:"blue-gray",children:["BALANCE OF ",h.latest_balance_month,":"," ",e.jsx("span",{className:"text-orange-900",children:h.latest_balance})]})]}),e.jsxs("div",{children:[e.jsx(i.Button,{onClick:n,variant:"gradient",children:"New Bill"}),e.jsx(i.Dialog,{open:s,handler:n,children:e.jsx(i.DialogBody,{children:e.jsxs(i.Card,{className:"h-[480px] w-full overflow-scroll",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(i.Typography,{variant:"h6",color:"blue-gray",children:"SEARCH CUSTOMER"}),e.jsx("input",{className:"w-96 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md pl-3 pr-10 py-2 transition duration-300 ease focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow",placeholder:"Search lastname..."})]}),e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsx("tr",{children:_.map(a=>e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:e.jsx(i.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:a})},a))})}),e.jsx("tbody",{children:g?e.jsx("tr",{children:e.jsx("td",{colSpan:_.length,className:"border border-blue-gray-100 p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(i.Spinner,{className:"h-10 w-10",color:"green"})})})}):L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:k.length,className:"border border-blue-gray-100 p-4 text-center text-red-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:["No customer records found",e.jsx(ke,{className:"text-xl"})]})})}):L.map(a=>{const{id:o,customer_name:p,status:w,plans:B}=a;return e.jsxs("tr",{className:"hover:bg-blue-gray-50 cursor-pointer",onClick:()=>De(a),children:[e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(i.Typography,{variant:"small",className:"font-normal text-gray-800",children:o})}),e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(i.Typography,{variant:"small",className:"font-normal text-gray-800",children:p})}),e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(i.Typography,{variant:"small",className:"font-normal text-gray-800",children:w})})]},o)})})]})]})})})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-1",children:[e.jsxs("div",{className:"w-full lg:w-[60%] h-[480px] overflow-auto p-4 border-2 border-sky-500",children:[e.jsx(i.Typography,{variant:"h6",color:"blue-gray",children:"ALL TRANSACTION"}),e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Month"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Bill No"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Partial"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Total Amount Paid"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Remarks"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Status"})]})}),e.jsx("tbody",{children:g?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"border p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(i.Spinner,{className:"h-10 w-10",color:"green"})})})}):Y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"border p-4 text-center text-red-500",children:"No transaction records found"})}):Y.map(a=>a.plans.flatMap(o=>o.transactions.map(p=>e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border px-4 py-2",children:new Date(p.created_at).toLocaleDateString("en-US")}),e.jsx("td",{className:"border px-4 py-2",children:p.bill_no}),e.jsx("td",{className:"border px-4 py-2",children:new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(p.partial)}),e.jsx("td",{className:"border px-4 py-2",children:new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(p.bill_amount)}),e.jsx("td",{className:"border px-4 py-2",children:p.remarks}),e.jsx("td",{className:"border px-4 py-2",children:p.status})]},p.id))))})]})]}),e.jsx("div",{className:"w-full lg:w-[35%] p-4 overflow-auto shadow-md rounded-md border-2 border-sky-500",children:e.jsxs("form",{onSubmit:z,children:[e.jsx("input",{type:"hidden",value:m.customer_plan_id,onChange:a=>b("customer_plan_id",a.target.value),className:"mb-2"}),e.jsx("input",{type:"hidden",value:m.collector_id,onChange:a=>b("collector__id",a.target.value),className:"mb-2"}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Acc No."}),e.jsx(i.Input,{size:"md",value:m.customer_plan_id,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill No."}),e.jsx(i.Input,{size:"md",value:m.bill_no,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill Amount"}),e.jsx(i.Input,{size:"md",value:h&&h.mbps?h.plan_price:"",disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance Previous Month"}),e.jsx(i.Input,{size:"md",value:h.latest_balance,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Rebate"}),e.jsx(i.Input,{type:"number",size:"md",value:m.rebate||"",onChange:a=>{const o=Number(a.target.value),p=Number(h.plan_price);o>p?(alert(`Rebate cannot be greater than Plan Price (${p}).`),b("rebate",p)):b("rebate",o)},className:"mb-3",onWheel:a=>a.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Total Amount Due"}),e.jsx(i.Input,{type:"number",size:"md",value:Number(h.plan_price)-Number(m.rebate||0),onChange:a=>b("bill_amount",a.target.value),className:"mb-3",disabled:!0})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Payment"}),e.jsx(i.Input,{type:"number",size:"md",value:m.partial||"",onChange:a=>{const o=Number(a.target.value),p=Number(h.plan_price)-Number(m.rebate||0);o>p?(alert(`Partial cannot be greater than Total Amount Paid (${p}).`),b("partial",p)):b("partial",o)},className:"mb-3",onWheel:a=>a.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance"}),e.jsx(i.Input,{size:"md",value:Number(m.partial)===Number(h.plan_price)?0:Math.max(0,Number(h.plan_price)-Number(m.rebate||0)-(Number(m.partial||0)+Number(m.bill_amount||0))),disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Date Billing"}),e.jsx(i.Input,{size:"md",type:"date",value:m.date_billing,onChange:a=>b("date_billing",a.target.value),error:!!v.date_billing,className:"w-full"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(i.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Status"}),e.jsx(Pe,{options:S,placeholder:"Choose a status",value:S.find(a=>a.value===m.status),onChange:a=>b("status",a?a.value:""),className:"mb-3"})]}),e.jsx(i.Button,{type:"submit",disabled:A,color:"blue",fullWidth:!0,children:"Save"})]})})]})]})]})};export{Ge as default};
