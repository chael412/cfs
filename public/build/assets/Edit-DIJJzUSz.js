import{a as n,b as T,j as a,M as S,r as e}from"./app-BLWsik55.js";import{S as P}from"./react-select.esm-B25H-jZD.js";import{A as w}from"./AuthenticatedLayout-96xluJqg.js";import"./NavLink-CRPLZxI3.js";import"./index-CL7d8cVu.js";const D=({transaction:l,collectors:z,latest:p})=>{const[B,b]=n.useState(""),[c,u]=n.useState(l.partial??0),[h,g]=n.useState(0),[v,x]=n.useState(0),{data:r,setData:o,patch:N,errors:y,reset:j,processing:I}=T({id:l.id,customer_id:l.customer_plan.customer.id,collector_id:l.customer_plan.collector.id,customer_plan_id:l.customer_plan_id,bill_no:l.bill_no,rebate:l.rebate,partial:l.partial,bill_amount:l.bill_amount,remarks:l.remarks,date_billing:l.date_billing,status:l.status}),d=[{value:"paid",label:"Paid"},{value:"unpaid",label:"Unpaid"}];console.log("Waw",JSON.stringify(l,null,2)),n.useEffect(()=>{const s=Number(l.customer_plan.plan.plan_price)||0,t=Number(r.rebate||0),i=Number(c||0),m=s-t;g(m);const f=m-i;x(f),o("bill_amount",m)},[r.rebate,c,l.customer_plan.plan.plan_price]);const _=async s=>{s.preventDefault(),console.log("Form Dataee:",JSON.stringify(r,null,2)),await N(route("transactions.update",r.id),{onSuccess:()=>{alert("Transaction updated successfully!"),window.location.reload(),j()},onError:t=>{console.log(t)}})};return a.jsxs(w,{children:[a.jsx(S,{title:"Billing Transactions"}),a.jsx("div",{className:"flex justify-center overflow-y-auto max-h-[590px]",children:a.jsx("div",{className:"mb-10 w-full lg:w-[45%] p-4 overflow-auto shadow-md rounded-md border-2 border-sky-500 ",children:a.jsxs("form",{onSubmit:_,children:[a.jsx("input",{type:"hidden",value:r.collector_id,onChange:s=>o("collector_id",s.target.value),className:"mb-2"}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Customer Name"}),a.jsx(e.Input,{size:"md",value:`${l.customer_plan.customer.firstname} ${l.customer_plan.customer.lastname}`,disabled:!0,className:"mb-3"})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Acc No."}),a.jsx(e.Input,{size:"md",value:r.customer_id,disabled:!0,className:"mb-3"})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill No."}),a.jsx(e.Input,{size:"md",value:r.bill_no,disabled:!0,className:"mb-3"})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill Amount"}),a.jsx(e.Input,{size:"md",value:l.customer_plan.plan.plan_price,disabled:!0,className:"mb-3"})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance Previous Month"}),a.jsx(e.Input,{size:"md",value:p.balance??0,disabled:!0,className:"mb-3"})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Rebate"}),a.jsx(e.Input,{type:"number",size:"md",value:r.rebate??0,onChange:s=>{const t=Number(s.target.value),i=Number(l.customer_plan.plan.plan_price);t>i?(alert(`Rebate cannot be greater than Plan Price (${i}).`),o("rebate",i)):o("rebate",t),b(t)},className:"mb-3",onWheel:s=>s.target.blur()})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Total Amount Due"}),a.jsx(e.Input,{type:"number",size:"md",value:h,className:"mb-3",disabled:!0})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Payment"}),a.jsx(e.Input,{type:"number",size:"md",value:r.partial??0,onChange:s=>{const t=Number(s.target.value),i=Number(l.customer_plan.plan.plan_price)-Number(r.rebate||0);t>i?(alert(`Partial cannot be greater than Total Amount Paid (${i}).`),o("partial",i),u(i)):(o("partial",t),u(t))},className:"mb-3",onWheel:s=>s.target.blur()})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance"}),a.jsx(e.Input,{size:"md",value:v,disabled:!0,className:"mb-3"})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Date Billing"}),a.jsx(e.Input,{size:"md",disabled:!0,type:"date",value:r.date_billing,onChange:s=>o("date_billing",s.target.value),error:!!y.date_billing,className:"w-full"})]}),a.jsxs("div",{className:"mb-1",children:[a.jsx(e.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Status"}),a.jsx(P,{options:d,placeholder:"Choose a status",value:d.find(s=>s.value===r.status),onChange:s=>o("status",s?s.value:""),className:"mb-3"})]}),a.jsx(e.Button,{type:"submit",color:"blue",fullWidth:!0,children:"Update"})]})})})]})};export{D as default};
