import{w as Me,a as $,V as _e,b as De,j as e,M as Te,r as h,U as Ce,c as se}from"./app-CawkInwG.js";import{A as Oe,B as ke}from"./AuthenticatedLayout-CqSJT2Y5.js";import{S as Ae}from"./react-select.esm-BNiqHb1T.js";import{U as Pe}from"./UseAppUrl-CShpvXxE.js";import{u as $e}from"./useQuery-DIYBNcr6.js";import{l as Be}from"./index-DTsyKTMn.js";import{f as Se}from"./format-BzRktsyD.js";var ae={exports:{}},Ie=ae.exports,we;function Ee(){return we||(we=1,function(ne,le){(function(L,S){ne.exports=S()})(Ie,function(){var L=1e3,S=6e4,Q=36e5,b="millisecond",P="second",k="minute",B="hour",i="day",Y="week",v="month",Z="quarter",T="year",I="date",q="Invalid Date",te=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ie=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,G={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var s=["th","st","nd","rd"],a=c%100;return"["+c+(s[(a-20)%10]||s[a]||s[0])+"]"}},K=function(c,s,a){var l=String(c);return!l||l.length>=s?c:""+Array(s+1-l.length).join(a)+c},z={s:K,z:function(c){var s=-c.utcOffset(),a=Math.abs(s),l=Math.floor(a/60),t=a%60;return(s<=0?"+":"-")+K(l,2,"0")+":"+K(t,2,"0")},m:function c(s,a){if(s.date()<a.date())return-c(a,s);var l=12*(a.year()-s.year())+(a.month()-s.month()),t=s.clone().add(l,v),o=a-t<0,n=s.clone().add(l+(o?-1:1),v);return+(-(l+(a-t)/(o?t-n:n-t))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:v,y:T,w:Y,d:i,D:I,h:B,m:k,s:P,ms:b,Q:Z}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},R="en",w={};w[R]=G;var J="$isDayjsObject",X=function(c){return c instanceof V||!(!c||!c[J])},F=function c(s,a,l){var t;if(!s)return R;if(typeof s=="string"){var o=s.toLowerCase();w[o]&&(t=o),a&&(w[o]=a,t=o);var n=s.split("-");if(!t&&n.length>1)return c(n[0])}else{var u=s.name;w[u]=s,t=u}return!l&&t&&(R=t),t||!l&&R},g=function(c,s){if(X(c))return c.clone();var a=typeof s=="object"?s:{};return a.date=c,a.args=arguments,new V(a)},p=z;p.l=F,p.i=X,p.w=function(c,s){return g(c,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var V=function(){function c(a){this.$L=F(a.locale,null,!0),this.parse(a),this.$x=this.$x||a.x||{},this[J]=!0}var s=c.prototype;return s.parse=function(a){this.$d=function(l){var t=l.date,o=l.utc;if(t===null)return new Date(NaN);if(p.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var n=t.match(te);if(n){var u=n[2]-1||0,f=(n[7]||"0").substring(0,3);return o?new Date(Date.UTC(n[1],u,n[3]||1,n[4]||0,n[5]||0,n[6]||0,f)):new Date(n[1],u,n[3]||1,n[4]||0,n[5]||0,n[6]||0,f)}}return new Date(t)}(a),this.init()},s.init=function(){var a=this.$d;this.$y=a.getFullYear(),this.$M=a.getMonth(),this.$D=a.getDate(),this.$W=a.getDay(),this.$H=a.getHours(),this.$m=a.getMinutes(),this.$s=a.getSeconds(),this.$ms=a.getMilliseconds()},s.$utils=function(){return p},s.isValid=function(){return this.$d.toString()!==q},s.isSame=function(a,l){var t=g(a);return this.startOf(l)<=t&&t<=this.endOf(l)},s.isAfter=function(a,l){return g(a)<this.startOf(l)},s.isBefore=function(a,l){return this.endOf(l)<g(a)},s.$g=function(a,l,t){return p.u(a)?this[l]:this.set(t,a)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(a,l){var t=this,o=!!p.u(l)||l,n=p.p(a),u=function(C,N){var M=p.w(t.$u?Date.UTC(t.$y,N,C):new Date(t.$y,N,C),t);return o?M:M.endOf(i)},f=function(C,N){return p.w(t.toDate()[C].apply(t.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(N)),t)},y=this.$W,j=this.$M,_=this.$D,E="set"+(this.$u?"UTC":"");switch(n){case T:return o?u(1,0):u(31,11);case v:return o?u(1,j):u(0,j+1);case Y:var A=this.$locale().weekStart||0,H=(y<A?y+7:y)-A;return u(o?_-H:_+(6-H),j);case i:case I:return f(E+"Hours",0);case B:return f(E+"Minutes",1);case k:return f(E+"Seconds",2);case P:return f(E+"Milliseconds",3);default:return this.clone()}},s.endOf=function(a){return this.startOf(a,!1)},s.$set=function(a,l){var t,o=p.p(a),n="set"+(this.$u?"UTC":""),u=(t={},t[i]=n+"Date",t[I]=n+"Date",t[v]=n+"Month",t[T]=n+"FullYear",t[B]=n+"Hours",t[k]=n+"Minutes",t[P]=n+"Seconds",t[b]=n+"Milliseconds",t)[o],f=o===i?this.$D+(l-this.$W):l;if(o===v||o===T){var y=this.clone().set(I,1);y.$d[u](f),y.init(),this.$d=y.set(I,Math.min(this.$D,y.daysInMonth())).$d}else u&&this.$d[u](f);return this.init(),this},s.set=function(a,l){return this.clone().$set(a,l)},s.get=function(a){return this[p.p(a)]()},s.add=function(a,l){var t,o=this;a=Number(a);var n=p.p(l),u=function(j){var _=g(o);return p.w(_.date(_.date()+Math.round(j*a)),o)};if(n===v)return this.set(v,this.$M+a);if(n===T)return this.set(T,this.$y+a);if(n===i)return u(1);if(n===Y)return u(7);var f=(t={},t[k]=S,t[B]=Q,t[P]=L,t)[n]||1,y=this.$d.getTime()+a*f;return p.w(y,this)},s.subtract=function(a,l){return this.add(-1*a,l)},s.format=function(a){var l=this,t=this.$locale();if(!this.isValid())return t.invalidDate||q;var o=a||"YYYY-MM-DDTHH:mm:ssZ",n=p.z(this),u=this.$H,f=this.$m,y=this.$M,j=t.weekdays,_=t.months,E=t.meridiem,A=function(N,M,U,W){return N&&(N[M]||N(l,o))||U[M].slice(0,W)},H=function(N){return p.s(u%12||12,N,"0")},C=E||function(N,M,U){var W=N<12?"AM":"PM";return U?W.toLowerCase():W};return o.replace(ie,function(N,M){return M||function(U){switch(U){case"YY":return String(l.$y).slice(-2);case"YYYY":return p.s(l.$y,4,"0");case"M":return y+1;case"MM":return p.s(y+1,2,"0");case"MMM":return A(t.monthsShort,y,_,3);case"MMMM":return A(_,y);case"D":return l.$D;case"DD":return p.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return A(t.weekdaysMin,l.$W,j,2);case"ddd":return A(t.weekdaysShort,l.$W,j,3);case"dddd":return j[l.$W];case"H":return String(u);case"HH":return p.s(u,2,"0");case"h":return H(1);case"hh":return H(2);case"a":return C(u,f,!0);case"A":return C(u,f,!1);case"m":return String(f);case"mm":return p.s(f,2,"0");case"s":return String(l.$s);case"ss":return p.s(l.$s,2,"0");case"SSS":return p.s(l.$ms,3,"0");case"Z":return n}return null}(N)||n.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(a,l,t){var o,n=this,u=p.p(l),f=g(a),y=(f.utcOffset()-this.utcOffset())*S,j=this-f,_=function(){return p.m(n,f)};switch(u){case T:o=_()/12;break;case v:o=_();break;case Z:o=_()/3;break;case Y:o=(j-y)/6048e5;break;case i:o=(j-y)/864e5;break;case B:o=j/Q;break;case k:o=j/S;break;case P:o=j/L;break;default:o=j}return t?o:p.a(o)},s.daysInMonth=function(){return this.endOf(v).$D},s.$locale=function(){return w[this.$L]},s.locale=function(a,l){if(!a)return this.$L;var t=this.clone(),o=F(a,l,!0);return o&&(t.$L=o),t},s.clone=function(){return p.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},c}(),ee=V.prototype;return g.prototype=ee,[["$ms",b],["$s",P],["$m",k],["$H",B],["$W",i],["$M",v],["$y",T],["$D",I]].forEach(function(c){ee[c[1]]=function(s){return this.$g(s,c[0],c[1])}}),g.extend=function(c,s){return c.$i||(c(s,V,g),c.$i=!0),g},g.locale=F,g.isDayjs=X,g.unix=function(c){return g(1e3*c)},g.en=w[R],g.Ls=w,g.p={},g})}(ae)),ae.exports}var He=Ee();const Le=Me(He),Je=({collectors:ne,generated_bill_no:le})=>{var ce,oe,de,ue,me,he,pe,be,fe,xe,ge,ye,je,Ne,ve;const L=Pe(),[S,Q]=$.useState(null),[b,P]=$.useState({}),[k,B]=$.useState(""),[i,Y]=$.useState(null),v=$.useRef(),Z=Be.useReactToPrint({contentRef:v}),T=async({queryKey:r})=>{const[d,m,D,O,x]=r;return(await se.get(`${L}/api/customers/transactions`,{params:{page:m,search:D,sortColumn:O,sortDirection:x}})).data},I=async({queryKey:r})=>{const[d,m,D,O,x]=r;return x?(await se.get(`${L}/api/customers/transactions`,{params:{page:m,search:x,sortColumn:D,sortDirection:O}})).data:{data:[],current_page:1}},{customers:q}=_e().props,[te,ie]=$.useState(""),[G,K]=$.useState((q==null?void 0:q.current_page)||1),[z,R]=$.useState({column:"",direction:"asc"}),{customer_transactions:w}=_e().props;$.useState(""),$.useState((w==null?void 0:w.current_page)||1),$.useState({column:"",direction:"asc"});const{data:J,error:X,isLoading:F,refetch:g}=$e({queryKey:["customers",G,te,z.column,z.direction],queryFn:T,keepPreviousData:!0}),{data:p,isTransLoading:V,refetch:ee}=$e({queryKey:["customer-transactions",G,z.column,z.direction,S],queryFn:I,enabled:!!S,keepPreviousData:!0}),[c,s]=$.useState(!1),a=()=>s(!c),[l,t]=$.useState(!1),o=()=>{t(!l)},{data:n,setData:u,post:f,errors:y,reset:j,processing:_}=De({customer_plan_id:"",bill_no:le,rebate:"",partial:"",bill_amount:"",remarks:"",status:""}),E=async r=>{var D,O;if(r.preventDefault(),!n.customer_plan_id||Number(n.customer_plan_id)<=0){alert("Please select a customer.");return}if(!((D=n.remarks)!=null&&D.trim())){alert("Choose a billing type.");return}if(!n.partial||Number(n.partial)<=0){alert("Partial payment is required");return}if(!((O=n.status)!=null&&O.trim())){alert("Status is required.");return}const d=Number((b==null?void 0:b.plan_price)||0)-Number(n.rebate||0),m={...n,bill_amount:d,rebate:Number(n.rebate)||0,partial:Number(n.partial)||0};try{console.log("Form data to submit:",JSON.stringify(m,null,2));const x=await se.post(`${L}/api/transactions`,m);Y(x.data),console.log("Response:",x.data),t(!0),u("rebate",""),u("partial",""),u("remarks",""),u("status",""),ee()}catch(x){console.error("Error creating transaction:",x.response||x),alert("Failed to create transaction. Check console for details.")}},A=["Month","Bill Noww.","Bill Amount","Status"],H=["Acc No.","Customer Name","Status"],C=[{value:"paid",label:"Paid"},{value:"unpaid",label:"Unpaid"}],N=(J==null?void 0:J.data.map(r=>({id:r.id,customer_name:`${r.lastname} ${r.firstname} ${r.middlename??""}`,firstname:r.firstname,middlename:r.middlename,lastname:r.lastname,address:r.address,contact_no:r.contact_no,sex:r.sex,marital_status:r.marital_status,birthdate:r.birthdate,occupation:r.occupation,status:r.status,plans:r.customer_plans.map(d=>{const m=d.transactions.length?[...d.transactions].sort((x,re)=>new Date(re.created_at)-new Date(x.created_at))[0]:null;let D=null,O=null;return m&&(D=Number(m.bill_amount)-Number(m.partial),O=Le(m.created_at).format("MMMM")),{customer_plan_id:d.id,mbps:d.plan.mbps,plan_price:d.plan.plan_price,date_registration:d.date_registration,latest_balance:d.latest_balance,latest_balance_month:d.latest_balance_month,transactions:d.transactions.map(x=>({id:x.id,bill_no:x.bill_no,rebate:x.rebate,partial:x.partial,bill_amount:x.bill_amount,remarks:x.remarks,status:x.status,created_at:x.created_at})),last_transaction:m,balance:D,balanceMonth:O}})})))||[],M=(p==null?void 0:p.data.map(r=>({id:r.id,customer_name:`${r.lastname} ${r.firstname} ${r.middlename??""}`,firstname:r.firstname,middlename:r.middlename,lastname:r.lastname,address:r.address,contact_no:r.contact_no,sex:r.sex,marital_status:r.marital_status,birthdate:r.birthdate,occupation:r.occupation,status:r.status,plans:r.customer_plans.map(d=>({customer_plan_id:d.id,mbps:d.plan.mbps,plan_price:d.plan.plan_price,date_registration:d.date_registration,transactions:d.transactions.map(m=>({id:m.id,bill_no:m.bill_no,rebate:Number(m.rebate)||0,partial:Number(m.partial)||0,bill_amount:Number(m.bill_amount)||0,remarks:m.remarks,status:m.status,created_at:m.created_at,updated_at:m.updated_at}))}))})))||[];$.useEffect(()=>{S!==null&&alert(`Selected Customer: ${b.customer_name}`)},[S,b]);const U=r=>{const d=r.plans[0]||{};Q(r.id),u("customer_plan_id",d.customer_plan_id),P({customer_name:`${r.firstname} ${r.lastname}`,customer_plan_id:d.customer_plan_id,mbps:d.mbps||"N/A",plan_price:d.plan_price||"N/A",date_registration:d.date_registration||"N/A",latest_balance:d.latest_balance||0,latest_balance_month:d.latest_balance_month||"N/A"}),s(!1)},W=r=>{const d=r.target.value;B(d),u("remarks",d)};return e.jsxs(Oe,{children:[e.jsx(Te,{title:"Create New Bill"}),e.jsxs("div",{className:"bg-white overflow-y-auto max-h-[590px] grid place-justify-center ",children:[e.jsxs("div",{className:"flex justify-between mt-5 mb-2 px-4",children:[e.jsxs("div",{className:"flex gap-10",children:[e.jsx(h.Radio,{name:"type",label:"Advance Billing",value:"advance",checked:k==="advance",onChange:W}),e.jsx(h.Radio,{name:"type",label:"Batch Billing",value:"batch",checked:k==="batch",onChange:W})]}),e.jsx(h.Tooltip,{content:"Back",children:e.jsx(Ce,{href:"/transactions",className:"hover:bg-gray-200 px-2 py-1 rounded",children:e.jsx(ke,{className:"text-xl cursor-pointer"})})})]}),e.jsxs(h.Dialog,{open:l,handler:o,size:"lg",children:[e.jsx(h.DialogHeader,{children:"Billing Notice"}),e.jsx(h.DialogBody,{children:e.jsx("div",{className:"h-[480px] overflow-auto",children:e.jsxs("div",{ref:v,className:"relative  p-6 rounded shadow",children:[e.jsx("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rotate-[-30deg]
                text-green-800 font-bold text-6xl border-2 border-green-800
  px-8 py-4 opacity-40 select-none pointer-events-none
                whitespace-nowrap inline-block`,children:"CFS NOTICE PAID"}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("img",{src:"/img/internet.png",alt:"CFS Logo",className:"w-16 h-16"}),e.jsxs("div",{className:"text-sm mt-1",children:["#2, Manguelod Bldg. National High Way",e.jsx("br",{}),"District II, Tumauini, Isabela",e.jsx("br",{}),"TIN: 295-973-965-001",e.jsx("br",{}),"CP#: 09453367030"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:i!=null&&i.customer?[(ce=i.customer)==null?void 0:ce.firstname,(oe=i.customer)==null?void 0:oe.middlename,(de=i.customer)==null?void 0:de.lastname].filter(Boolean).join(" "):""}),e.jsx("p",{children:(ue=i==null?void 0:i.transaction)!=null&&ue.created_at?Se(new Date(i.transaction.created_at),"MMMM dd, yyyy"):""})]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Acct. No:"}),e.jsx("span",{children:((he=(me=i==null?void 0:i.transaction)==null?void 0:me.customer_plan)==null?void 0:he.customer_id)??""})]}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{children:"Bill No."}),e.jsx("span",{children:((pe=i==null?void 0:i.transaction)==null?void 0:pe.bill_no)??""})]}),e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Bill for the month of August"}),e.jsxs("span",{children:["₱"," ",((be=i==null?void 0:i.transaction)==null?void 0:be.bill_amount)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rebate"}),e.jsxs("span",{children:["₱"," ",((fe=i==null?void 0:i.transaction)==null?void 0:fe.rebate)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Partial"}),e.jsxs("span",{children:["₱"," ",((xe=i==null?void 0:i.transaction)==null?void 0:xe.partial)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Outstanding Balance Previous Month"}),e.jsxs("span",{children:["₱"," ",(i==null?void 0:i.outstanding_balance)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between font-bold border-t border-gray-400 pt-2",children:[e.jsx("span",{children:"Amount Due:"}),e.jsxs("span",{children:["₱"," ",((ge=i==null?void 0:i.transaction)==null?void 0:ge.bill_amount)??"0.00"]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-4",children:[e.jsx("span",{children:"Prepared by: John"}),e.jsxs("span",{children:["Collector:"," ",i!=null&&i.customer?[(ye=i.collector)==null?void 0:ye.firstname,(je=i.collector)==null?void 0:je.middlename,(Ne=i.collector)==null?void 0:Ne.lastname].filter(Boolean).join(" "):""]}),e.jsxs("span",{children:["Date:"," ",(ve=i==null?void 0:i.transaction)!=null&&ve.created_at?Se(new Date(i.transaction.created_at),"MMMM dd, yyyy"):""]})]}),e.jsxs("div",{className:"border border-red-500 p-3 rounded text-sm bg-red-50 flex items-start gap-2",children:[e.jsx("div",{className:"text-red-600 font-bold",children:"⚠"}),e.jsxs("div",{children:[e.jsx("p",{children:"7 Days Notice: To avoid temporary disconnection kindly settle your bill within 7 days of the due date. For assistance or to make a payment please call:"}),e.jsx("p",{className:"font-bold",children:"CUSTOMER SERVICE NO: 09453367030"}),e.jsx("p",{className:"font-bold",children:"BILLING DEPT. CP NO: 09162832206"})]})]})]})})}),e.jsxs(h.DialogFooter,{children:[e.jsx(h.Button,{variant:"text",color:"red",onClick:o,className:"mr-2",children:"Cancel"}),e.jsx(h.Button,{variant:"gradient",color:"green",onClick:()=>Z(),children:"Print"})]})]}),e.jsxs("div",{className:"flex justify-between items-center px-4",children:[e.jsxs("div",{className:"flex gap-6 px-4",children:[e.jsxs(h.Typography,{variant:"h6",color:"blue-gray",children:["ACC NO.:"," ",e.jsx("span",{className:"text-orange-900",children:S})]}),e.jsxs(h.Typography,{variant:"h6",color:"blue-gray",children:["CUSTOMER:"," ",e.jsx("span",{className:"text-orange-900",children:(b==null?void 0:b.customer_name)||""})]}),e.jsxs(h.Typography,{variant:"h6",color:"blue-gray",children:["PLAN:"," ",e.jsx("span",{className:"text-orange-900",children:b&&b.mbps?`${b.mbps} mbps - ${new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(b.plan_price)}`:""})]}),e.jsxs(h.Typography,{variant:"h6",color:"blue-gray",children:["REGISTRATION:"," ",e.jsx("span",{className:"text-orange-900",children:b.date_registration})]}),e.jsxs(h.Typography,{variant:"h6",color:"blue-gray",children:["BALANCE OF ",b.latest_balance_month,":"," ",e.jsx("span",{className:"text-orange-900",children:b.latest_balance})]})]}),e.jsxs("div",{children:[e.jsx(h.Button,{onClick:a,variant:"gradient",children:"New Bill"}),e.jsx(h.Dialog,{open:c,handler:a,children:e.jsx(h.DialogBody,{children:e.jsxs(h.Card,{className:"h-[480px] w-full overflow-scroll",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(h.Typography,{variant:"h6",color:"blue-gray",children:"SEARCH CUSTOMER"}),e.jsx("input",{className:"w-96 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md pl-3 pr-10 py-2 transition duration-300 ease focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow",placeholder:"Search lastname..."})]}),e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsx("tr",{children:H.map(r=>e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:e.jsx(h.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:r})},r))})}),e.jsx("tbody",{children:F?e.jsx("tr",{children:e.jsx("td",{colSpan:H.length,className:"border border-blue-gray-100 p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(h.Spinner,{className:"h-10 w-10",color:"green"})})})}):N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:A.length,className:"border border-blue-gray-100 p-4 text-center text-red-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:["No customer records found",e.jsx(CgDanger,{className:"text-xl"})]})})}):N.map(r=>{const{id:d,customer_name:m,status:D,plans:O}=r;return e.jsxs("tr",{className:"hover:bg-blue-gray-50 cursor-pointer",onClick:()=>U(r),children:[e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(h.Typography,{variant:"small",className:"font-normal text-gray-800",children:d})}),e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(h.Typography,{variant:"small",className:"font-normal text-gray-800",children:m})}),e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(h.Typography,{variant:"small",className:"font-normal text-gray-800",children:D})})]},d)})})]})]})})})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-1",children:[e.jsxs("div",{className:"w-full lg:w-[60%] h-[480px] overflow-auto p-4 border-2 border-sky-500",children:[e.jsx(h.Typography,{variant:"h6",color:"blue-gray",children:"ALL TRANSACTION"}),e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Month"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Bill No"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Partial"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Total Amount Paid"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Remarks"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Status"})]})}),e.jsx("tbody",{children:F?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"border p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(h.Spinner,{className:"h-10 w-10",color:"green"})})})}):M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"border p-4 text-center text-red-500",children:"No transaction records found"})}):M.map(r=>r.plans.flatMap(d=>d.transactions.map(m=>e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border px-4 py-2",children:new Date(m.created_at).toLocaleDateString("en-US")}),e.jsx("td",{className:"border px-4 py-2",children:m.bill_no}),e.jsx("td",{className:"border px-4 py-2",children:new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(m.partial)}),e.jsx("td",{className:"border px-4 py-2",children:new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(m.bill_amount)}),e.jsx("td",{className:"border px-4 py-2",children:m.remarks}),e.jsx("td",{className:"border px-4 py-2",children:m.status})]},m.id))))})]})]}),e.jsx("div",{className:"w-full lg:w-[35%] p-4 overflow-auto shadow-md rounded-md border-2 border-sky-500",children:e.jsxs("form",{onSubmit:E,children:[e.jsx("input",{type:"hidden",value:n.customer_plan_id,onChange:r=>u("customer_plan_id",r.target.value),className:"mb-2"}),e.jsxs("div",{className:"mb-1",children:[e.jsx(h.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Acc No."}),e.jsx(h.Input,{size:"md",value:n.customer_plan_id,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(h.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill No."}),e.jsx(h.Input,{size:"md",value:n.bill_no,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(h.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Rebate"}),e.jsx(h.Input,{type:"number",size:"md",value:n.rebate||"",onChange:r=>{const d=Number(r.target.value),m=Number(b.plan_price);d>m?(alert(`Rebate cannot be greater than Plan Price (${m}).`),u("rebate",m)):u("rebate",d)},className:"mb-3",onWheel:r=>r.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(h.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Partial"}),e.jsx(h.Input,{type:"number",size:"md",value:n.partial||"",onChange:r=>{const d=Number(r.target.value),m=Number(b.plan_price)-Number(n.rebate||0);d>m?(alert(`Partial cannot be greater than Total Amount Paid (${m}).`),u("partial",m)):u("partial",d)},className:"mb-3",onWheel:r=>r.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(h.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Total Amount Paid"}),e.jsx(h.Input,{type:"number",size:"md",value:Number(b.plan_price)-Number(n.rebate||0),onChange:r=>u("bill_amount",r.target.value),className:"mb-3",disabled:!0})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(h.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance"}),e.jsx(h.Input,{size:"md",value:Number(n.partial)===Number(b.plan_price)?0:Math.max(0,Number(b.plan_price)-Number(n.rebate||0)-(Number(n.partial||0)+Number(n.bill_amount||0))),disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(h.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Status"}),e.jsx(Ae,{options:C,placeholder:"Choose a status",value:C.find(r=>r.value===n.status),onChange:r=>u("status",r?r.value:""),className:"mb-3"})]}),e.jsx(h.Button,{type:"submit",disabled:_,color:"blue",fullWidth:!0,children:"Save"})]})})]})]})]})};export{Je as default};
