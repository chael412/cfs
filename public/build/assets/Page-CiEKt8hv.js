import{a as r,j as e,M as I,r as t,c as P}from"./app-CzqB4iHd.js";import{A as M}from"./AuthenticatedLayout-H7Gok2V5.js";import{l as k}from"./index-BmEClpM7.js";import{U as G}from"./UseAppUrl-BYLJImY-.js";import"./NavLink-DR4YcvIJ.js";import"./index-yYnciwfN.js";const H=()=>{const p=G(),[n,_]=r.useState(""),[s,E]=r.useState(new Date().getMonth()+1),[l,R]=r.useState(new Date().getFullYear()),[h,$]=r.useState([]),[o,m]=r.useState(!1),[x,A]=r.useState(""),[c,i]=r.useState(null),[u,d]=r.useState(!1),F=async()=>{if(!n||!s||!l)return alert("Please select all filters!");try{m(!0);const a=await P.get(`${p}/api/batch-unpaid/${n}?month=${s}&year=${l}`);$(a.data.transactions||[])}catch(a){console.error("Error fetching unpaid transactions:",a)}finally{m(!1)}},g=r.useRef(),L=k.useReactToPrint({contentRef:g}),U=async()=>{if(!x)return alert("Please select a batch!");try{d(!0),i(null);const a=await P.post(`${p}/api/batch-billing/generate/${x}`);setTimeout(()=>{i(a.data),d(!1)},5e3)}catch(a){console.error("Error generating batch:",a),d(!1)}};return r.useEffect(()=>{if(c){const a=setTimeout(()=>{i(null),window.location.reload()},3e3);return()=>clearTimeout(a)}},[c]),e.jsxs(M,{children:[e.jsx(I,{title:"Generate Batch Bill"}),e.jsx("div",{className:"flex justify-end items-center ",children:e.jsx(t.Button,{variant:"gradient",className:"",color:"green",onClick:()=>L(),children:"Print"})}),e.jsxs("div",{className:"flex justify-center flex-col items-center",children:[e.jsx("h1",{className:"text-4xl mt-1 mb-5",children:"Batch Billing Generation"}),e.jsxs("div",{className:"max-w-[800px] mb-2",children:[e.jsxs("h3",{children:["Generate Batch Billing for the month"," ",new Date().toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs(t.Select,{label:"Select Batch",onChange:a=>A(a),children:[e.jsx(t.Option,{value:"1",children:"Batch 1"}),e.jsx(t.Option,{value:"2",children:"Batch 2"}),e.jsx(t.Option,{value:"3",children:"Batch 3"}),e.jsx(t.Option,{value:"4",children:"Batch 4"}),e.jsx(t.Option,{value:"5",children:"Batch 5"}),e.jsx(t.Option,{value:"6",children:"Batch 6 (All Cheque)"})]}),e.jsx(t.Button,{onClick:U,disabled:u,children:u?"Generating...":"Generate"})]})]}),c&&e.jsx("div",{className:"mt-6 p-4 bg-green-200 rounded-md w-full text-center text-green-800",children:e.jsx(t.Typography,{variant:"h6",children:"Batch bill generated successfully."})}),e.jsx("div",{className:"max-w-[920px] w-full border-t border-gray-300 ",children:e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs(t.Select,{label:"Select Batch",onChange:a=>_(a),children:[e.jsx(t.Option,{value:"1",children:"Batch 1"}),e.jsx(t.Option,{value:"2",children:"Batch 2"}),e.jsx(t.Option,{value:"3",children:"Batch 3"}),e.jsx(t.Option,{value:"4",children:"Batch 4"}),e.jsx(t.Option,{value:"5",children:"Batch 5"}),e.jsx(t.Option,{value:"6",children:"Batch 6 (All Cheque)"})]}),e.jsx(t.Input,{type:"number",label:"Month",value:s,onChange:a=>E(a.target.value),min:1,max:12}),e.jsx(t.Input,{type:"number",label:"Year",value:l,onChange:a=>R(a.target.value),min:2e3,max:2100}),e.jsx(t.Button,{onClick:F,disabled:o,children:o?"Fetching...":"Filter"})]})})]}),e.jsx("div",{className:"px-4 mt-5 h-[420px] overflow-auto",children:e.jsxs("div",{ref:g,className:"print:px-2",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"CFS INTERNET NETWORK SOLUTION"}),e.jsxs("h3",{className:"text-lg",children:["Batch",n??"","(",s??"","/",l??""," )"]})]}),e.jsxs("table",{className:" w-full  text-left border border-gray-300 text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(t.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Bill No"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(t.Typography,{variant:"small",color:"blue-gray",className:" text-[12px] font-normal leading-none opacity-70",children:"Customer No."})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(t.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Customer Name"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(t.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Address"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(t.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Mbps"})}),e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(t.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:"Plan price"})}),e.jsx("th",{className:" w-[10%] px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(t.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70"})})]})}),e.jsx("tbody",{children:h.length>0?h.map(a=>{var b,y,j,f,N,v,B,T,S,O,w,C;return e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border border-blue-gray-100 px-4 ",children:a.bill_no}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:(b=a.customer_plan.customer)==null?void 0:b.id}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:`${(y=a.customer_plan.customer)==null?void 0:y.firstname} ${(j=a.customer_plan.customer)==null?void 0:j.lastname}`}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:[(v=(N=(f=a.customer_plan.customer)==null?void 0:f.purok)==null?void 0:N.barangay)==null?void 0:v.barangay_name,", ",(O=(S=(T=(B=a.customer_plan.customer)==null?void 0:B.purok)==null?void 0:T.barangay)==null?void 0:S.municipality)==null?void 0:O.municipality_name]}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:[(w=a.customer_plan.plan)==null?void 0:w.mbps," mbps"]}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:["â‚±",(C=a.customer_plan.plan)==null?void 0:C.plan_price]}),e.jsx("td",{className:"border border-blue-gray-100 px-4"})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4",children:o?"Fetching data...":"No records found"})})})]})]})})]})};export{H as default};
