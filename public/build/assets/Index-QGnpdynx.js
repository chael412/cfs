import{a as n,j as e,M as E,r as s,U as u,c as w}from"./app-CzpXzm04.js";import{C as O}from"./index-BFKps3yz.js";import{d as _,A as U,a as $}from"./index-C-A177l7.js";import{A as R}from"./AuthenticatedLayout-DdiryBAS.js";import{u as H}from"./useQuery-B717RXj0.js";import{P as Y}from"./Pagination-Dtu3p2yU.js";import{U as q}from"./UseAppUrl-TjchyqUf.js";import{f as A}from"./format-BzRktsyD.js";import"./NavLink-CbeVwNRP.js";const g=["Bill NO.","Customer Name","Mbps Plan","Payment","Total Amount Paid","Date Billing","Payment Date","Status","Actions"],ae=()=>{const M=q(),y=new Date,[l,P]=n.useState(y.getMonth()+1),[c,S]=n.useState(y.getFullYear()),T=["January","February","March","April","May","June","July","August","September","October","November","December"],[j,D]=n.useState(""),[o,b]=n.useState(1),[v,z]=n.useState({column:"",direction:"desc"}),C=async({queryKey:a})=>{const[t,i,m,d,x,h,p]=a;return(await w.get(`${M}/api/transactions-advance`,{params:{page:i,search:m,sortColumn:d,sortDirection:x,month:h,year:p}})).data},{data:r,isLoading:B,refetch:F}=H({queryKey:["advance_bills",o,j,v.column,v.direction,l,c],queryFn:C,keepPreviousData:!0}),I=a=>{D(a.target.value),a.target.value||b(1)},L=a=>b(a),k=async a=>{if(window.confirm("Are you sure you want to delete this bill transaction?"))try{const t=await w.delete(`/admin/transactions/${a}`);alert(t.data.message),F()}catch(t){console.error(t),alert("An unexpected error occurred. Please try again later.")}},f=(r==null?void 0:r.data.map(a=>({id:a.id,bill_no:a.bill_no,customer_name:`${a.customer_plan.customer.lastname} ${a.customer_plan.customer.firstname} ${a.customer_plan.middlename??""}`,mbps:a.customer_plan.plan.mbps,plan_price:a.customer_plan.plan.plan_price,amount:a.bill_amount,partial:a.partial,remarks:a.remarks,date_billing:a.date_billing,payment_date:a.created_at,status:a.status})))||[];return e.jsxs(R,{children:[e.jsx(E,{title:"Advance Transactions"}),e.jsxs("div",{className:"bg-white overflow-y-auto max-h-[590px]",children:[e.jsxs("div",{className:"mt-5 px-4",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(s.Typography,{variant:"lead",size:"small",className:"mb-0 text-lg font-bold",children:"Advance Transactions"}),e.jsx(s.Typography,{className:"text-sm",variant:"paragraph",size:"small",children:"Manage advance bill transactions"}),e.jsxs("nav",{className:"flex items-center space-x-1 text-gray-600 text-sm mt-3",children:[e.jsx("a",{href:"/admin/transactions",className:"hover:text-black",children:"Batch"}),e.jsx(_,{className:"w-4 h-4"}),e.jsx("a",{href:"/admin/transactions-advance",className:"font-bold text-blue-800",children:"Advance"}),e.jsx(_,{className:"w-4 h-4"})]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:["Month: ",T[l-1]]}),e.jsxs("p",{children:["Year: ",c]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-4 mb-3",children:[e.jsx("div",{className:"min-w-[100px]",children:e.jsx(s.Input,{type:"number",label:"Month",min:1,max:12,value:l,onChange:a=>P(a.target.value)})}),e.jsx("div",{className:"min-w-[120px]",children:e.jsx(s.Input,{type:"number",label:"Year",min:2e3,max:2100,value:c,onChange:a=>S(a.target.value)})}),e.jsx(s.Button,{className:"px-6",onClick:()=>window.location.reload(),children:"Reset"})]}),e.jsx("hr",{className:"border border-gray-300"}),e.jsxs("div",{className:"mt-5 w-full flex items-center justify-between flex-col-reverse gap-2 lg:flex-row",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(s.Input,{className:"bg-transparent text-sm",placeholder:"Search lastname...",value:j,onChange:I}),e.jsx(U,{className:"absolute top-1/2 right-3 -translate-y-1/2 text-slate-400"})]}),e.jsx("div",{children:e.jsx(u,{href:"/admin/transactions-advance/create",children:e.jsxs(s.Button,{className:"flex gap-2 items-center",color:"blue",size:"md",children:[e.jsx($,{className:"text-lg"}),"New Bill"]})})})]})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-x-auto max-w-min md:max-w-full",children:[e.jsxs("table",{className:"w-full min-w-[350px] text-left border border-gray-300",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-100",children:g.map(a=>e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(s.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:a})},a))})}),e.jsx("tbody",{children:B?e.jsx("tr",{children:e.jsx("td",{colSpan:g.length,className:"border border-blue-gray-100 p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(s.Spinner,{className:"h-10 w-10",color:"green"})})})}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:g.length,className:"border border-blue-gray-100 p-4 text-center text-red-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:["No bill records found",e.jsx(O,{className:"text-xl"})]})})}):f.map(({id:a,bill_no:t,customer_name:i,mbps:m,partial:d,amount:x,status:h,date_billing:p,payment_date:N})=>e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:t})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:i})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsxs(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:[m," mbps"]})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsxs(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:["₱"," ",parseFloat(d).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsxs(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:["₱"," ",parseFloat(x).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:A(new Date(p),"MM/dd/yyyy")})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:A(new Date(N),"MM/dd/yyyy")})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx(s.Typography,{variant:"small",className:"font-normal text-gray-800",children:h})}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(s.Menu,{children:[e.jsx(s.MenuHandler,{children:e.jsx(s.IconButton,{variant:"text",children:e.jsx(s.Tooltip,{content:"Actions",children:e.jsx("img",{src:"/img/dots.png",alt:""})})})}),e.jsxs(s.MenuList,{children:[e.jsx(u,{className:"hover:bg-blue-800 hover:rounded hover:text-white",href:route("transaction.advance.show",{id:a}),children:e.jsx(s.MenuItem,{children:"View"})}),e.jsx(u,{className:"hover:bg-blue-800 hover:rounded hover:text-white",href:route("transaction.advance.edit",{id:a}),children:e.jsx(s.MenuItem,{children:"Edit"})}),e.jsx(s.MenuItem,{onClick:()=>k(a),children:"Delete"})]})]})})})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center border-t border-blue-gray-50 p-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsxs(s.Typography,{variant:"small",color:"blue-gray",className:"font-normal",children:["Page ",r==null?void 0:r.current_page," of ",r==null?void 0:r.last_page]})}),e.jsxs("div",{className:"col-span-2 flex flex-col items-center",children:[e.jsx(Y,{currentPage:(r==null?void 0:r.current_page)||1,lastPage:(r==null?void 0:r.last_page)||1,onPageChange:L}),e.jsxs("div",{className:"mt-3 text-gray-700",children:["Showing ",(o-1)*10+1," to"," ",Math.min(o*10,r==null?void 0:r.total)," of"," ",r==null?void 0:r.total," entries"]})]})]})]})]})]})};export{ae as default};
