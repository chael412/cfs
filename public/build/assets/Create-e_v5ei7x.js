import{x as Me,a as N,V as ve,b as De,j as e,M as Te,r as o,U as Ce,c as se}from"./app-B7-ochgV.js";import{C as Oe}from"./index-Cxq0BM2H.js";import{A as Ae,B as ke}from"./AuthenticatedLayout-BAiGGxq0.js";import{S as Be}from"./react-select.esm-DrrXJown.js";import{U as Ie}from"./UseAppUrl-BK4Et2hn.js";import{u as $e}from"./useQuery-D8i9n-bF.js";import{l as Pe}from"./index-CiOIjtFm.js";import{f as Se}from"./format-BzRktsyD.js";var ae={exports:{}},Ee=ae.exports,we;function He(){return we||(we=1,function(ne,le){(function(L,S){ne.exports=S()})(Ee,function(){var L=1e3,S=6e4,Q=36e5,h="millisecond",B="second",A="minute",I="hour",i="day",z="week",v="month",Z="quarter",T="year",P="date",Y="Invalid Date",te=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,ie=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,G={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var s=["th","st","nd","rd"],a=c%100;return"["+c+(s[(a-20)%10]||s[a]||s[0])+"]"}},K=function(c,s,a){var l=String(c);return!l||l.length>=s?c:""+Array(s+1-l.length).join(a)+c},q={s:K,z:function(c){var s=-c.utcOffset(),a=Math.abs(s),l=Math.floor(a/60),r=a%60;return(s<=0?"+":"-")+K(l,2,"0")+":"+K(r,2,"0")},m:function c(s,a){if(s.date()<a.date())return-c(a,s);var l=12*(a.year()-s.year())+(a.month()-s.month()),r=s.clone().add(l,v),m=a-r<0,n=s.clone().add(l+(m?-1:1),v);return+(-(l+(a-r)/(m?r-n:n-r))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:v,y:T,w:z,d:i,D:P,h:I,m:A,s:B,ms:h,Q:Z}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},R="en",w={};w[R]=G;var J="$isDayjsObject",X=function(c){return c instanceof V||!(!c||!c[J])},F=function c(s,a,l){var r;if(!s)return R;if(typeof s=="string"){var m=s.toLowerCase();w[m]&&(r=m),a&&(w[m]=a,r=m);var n=s.split("-");if(!r&&n.length>1)return c(n[0])}else{var d=s.name;w[d]=s,r=d}return!l&&r&&(R=r),r||!l&&R},y=function(c,s){if(X(c))return c.clone();var a=typeof s=="object"?s:{};return a.date=c,a.args=arguments,new V(a)},b=q;b.l=F,b.i=X,b.w=function(c,s){return y(c,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var V=function(){function c(a){this.$L=F(a.locale,null,!0),this.parse(a),this.$x=this.$x||a.x||{},this[J]=!0}var s=c.prototype;return s.parse=function(a){this.$d=function(l){var r=l.date,m=l.utc;if(r===null)return new Date(NaN);if(b.u(r))return new Date;if(r instanceof Date)return new Date(r);if(typeof r=="string"&&!/Z$/i.test(r)){var n=r.match(te);if(n){var d=n[2]-1||0,f=(n[7]||"0").substring(0,3);return m?new Date(Date.UTC(n[1],d,n[3]||1,n[4]||0,n[5]||0,n[6]||0,f)):new Date(n[1],d,n[3]||1,n[4]||0,n[5]||0,n[6]||0,f)}}return new Date(r)}(a),this.init()},s.init=function(){var a=this.$d;this.$y=a.getFullYear(),this.$M=a.getMonth(),this.$D=a.getDate(),this.$W=a.getDay(),this.$H=a.getHours(),this.$m=a.getMinutes(),this.$s=a.getSeconds(),this.$ms=a.getMilliseconds()},s.$utils=function(){return b},s.isValid=function(){return this.$d.toString()!==Y},s.isSame=function(a,l){var r=y(a);return this.startOf(l)<=r&&r<=this.endOf(l)},s.isAfter=function(a,l){return y(a)<this.startOf(l)},s.isBefore=function(a,l){return this.endOf(l)<y(a)},s.$g=function(a,l,r){return b.u(a)?this[l]:this.set(r,a)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(a,l){var r=this,m=!!b.u(l)||l,n=b.p(a),d=function(C,_){var M=b.w(r.$u?Date.UTC(r.$y,_,C):new Date(r.$y,_,C),r);return m?M:M.endOf(i)},f=function(C,_){return b.w(r.toDate()[C].apply(r.toDate("s"),(m?[0,0,0,0]:[23,59,59,999]).slice(_)),r)},g=this.$W,j=this.$M,$=this.$D,E="set"+(this.$u?"UTC":"");switch(n){case T:return m?d(1,0):d(31,11);case v:return m?d(1,j):d(0,j+1);case z:var k=this.$locale().weekStart||0,H=(g<k?g+7:g)-k;return d(m?$-H:$+(6-H),j);case i:case P:return f(E+"Hours",0);case I:return f(E+"Minutes",1);case A:return f(E+"Seconds",2);case B:return f(E+"Milliseconds",3);default:return this.clone()}},s.endOf=function(a){return this.startOf(a,!1)},s.$set=function(a,l){var r,m=b.p(a),n="set"+(this.$u?"UTC":""),d=(r={},r[i]=n+"Date",r[P]=n+"Date",r[v]=n+"Month",r[T]=n+"FullYear",r[I]=n+"Hours",r[A]=n+"Minutes",r[B]=n+"Seconds",r[h]=n+"Milliseconds",r)[m],f=m===i?this.$D+(l-this.$W):l;if(m===v||m===T){var g=this.clone().set(P,1);g.$d[d](f),g.init(),this.$d=g.set(P,Math.min(this.$D,g.daysInMonth())).$d}else d&&this.$d[d](f);return this.init(),this},s.set=function(a,l){return this.clone().$set(a,l)},s.get=function(a){return this[b.p(a)]()},s.add=function(a,l){var r,m=this;a=Number(a);var n=b.p(l),d=function(j){var $=y(m);return b.w($.date($.date()+Math.round(j*a)),m)};if(n===v)return this.set(v,this.$M+a);if(n===T)return this.set(T,this.$y+a);if(n===i)return d(1);if(n===z)return d(7);var f=(r={},r[A]=S,r[I]=Q,r[B]=L,r)[n]||1,g=this.$d.getTime()+a*f;return b.w(g,this)},s.subtract=function(a,l){return this.add(-1*a,l)},s.format=function(a){var l=this,r=this.$locale();if(!this.isValid())return r.invalidDate||Y;var m=a||"YYYY-MM-DDTHH:mm:ssZ",n=b.z(this),d=this.$H,f=this.$m,g=this.$M,j=r.weekdays,$=r.months,E=r.meridiem,k=function(_,M,U,W){return _&&(_[M]||_(l,m))||U[M].slice(0,W)},H=function(_){return b.s(d%12||12,_,"0")},C=E||function(_,M,U){var W=_<12?"AM":"PM";return U?W.toLowerCase():W};return m.replace(ie,function(_,M){return M||function(U){switch(U){case"YY":return String(l.$y).slice(-2);case"YYYY":return b.s(l.$y,4,"0");case"M":return g+1;case"MM":return b.s(g+1,2,"0");case"MMM":return k(r.monthsShort,g,$,3);case"MMMM":return k($,g);case"D":return l.$D;case"DD":return b.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return k(r.weekdaysMin,l.$W,j,2);case"ddd":return k(r.weekdaysShort,l.$W,j,3);case"dddd":return j[l.$W];case"H":return String(d);case"HH":return b.s(d,2,"0");case"h":return H(1);case"hh":return H(2);case"a":return C(d,f,!0);case"A":return C(d,f,!1);case"m":return String(f);case"mm":return b.s(f,2,"0");case"s":return String(l.$s);case"ss":return b.s(l.$s,2,"0");case"SSS":return b.s(l.$ms,3,"0");case"Z":return n}return null}(_)||n.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(a,l,r){var m,n=this,d=b.p(l),f=y(a),g=(f.utcOffset()-this.utcOffset())*S,j=this-f,$=function(){return b.m(n,f)};switch(d){case T:m=$()/12;break;case v:m=$();break;case Z:m=$()/3;break;case z:m=(j-g)/6048e5;break;case i:m=(j-g)/864e5;break;case I:m=j/Q;break;case A:m=j/S;break;case B:m=j/L;break;default:m=j}return r?m:b.a(m)},s.daysInMonth=function(){return this.endOf(v).$D},s.$locale=function(){return w[this.$L]},s.locale=function(a,l){if(!a)return this.$L;var r=this.clone(),m=F(a,l,!0);return m&&(r.$L=m),r},s.clone=function(){return b.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},c}(),ee=V.prototype;return y.prototype=ee,[["$ms",h],["$s",B],["$m",A],["$H",I],["$W",i],["$M",v],["$y",T],["$D",P]].forEach(function(c){ee[c[1]]=function(s){return this.$g(s,c[0],c[1])}}),y.extend=function(c,s){return c.$i||(c(s,V,y),c.$i=!0),y},y.locale=F,y.isDayjs=X,y.unix=function(c){return y(1e3*c)},y.en=w[R],y.Ls=w,y.p={},y})}(ae)),ae.exports}var Le=He();const Fe=Me(Le),Qe=({collectors:ne,generated_bill_no:le})=>{var ce,oe,de,ue,me,he,pe,be,fe,xe,ge,ye,je,_e,Ne;const L=Ie(),[S,Q]=N.useState(null),[h,B]=N.useState({}),[A,I]=N.useState(""),[i,z]=N.useState(null);N.useState("");const v=N.useRef(),Z=Pe.useReactToPrint({contentRef:v}),T=async({queryKey:t})=>{const[u,p,D,O,x]=t;return(await se.get(`${L}/api/customers/transactions`,{params:{page:p,search:D,sortColumn:O,sortDirection:x}})).data},P=async({queryKey:t})=>{const[u,p,D,O,x]=t;return x?(await se.get(`${L}/api/customers/transactions`,{params:{page:p,search:x,sortColumn:D,sortDirection:O}})).data:{data:[],current_page:1}},{customers:Y}=ve().props,[te,ie]=N.useState(""),[G,K]=N.useState((Y==null?void 0:Y.current_page)||1),[q,R]=N.useState({column:"",direction:"asc"}),{customer_transactions:w}=ve().props;N.useState(""),N.useState((w==null?void 0:w.current_page)||1),N.useState({column:"",direction:"asc"});const{data:J,error:X,isLoading:F,refetch:y}=$e({queryKey:["customers",G,te,q.column,q.direction],queryFn:T,keepPreviousData:!0}),{data:b,isTransLoading:V,refetch:ee}=$e({queryKey:["customer-transactions",G,q.column,q.direction,S],queryFn:P,enabled:!!S,keepPreviousData:!0}),[c,s]=N.useState(!1),a=()=>s(!c),[l,r]=N.useState(!1),m=()=>{r(!l)},{data:n,setData:d,post:f,errors:g,reset:j,processing:$}=De({customer_plan_id:"",collector_id:"",bill_no:le,rebate:"",partial:"",bill_amount:"",remarks:"",status:"",date_billing:""}),E=async t=>{var D,O;if(t.preventDefault(),!n.customer_plan_id||Number(n.customer_plan_id)<=0){alert("Please select a customer.");return}if(!((D=n.remarks)!=null&&D.trim())){alert("Choose a billing type.");return}if(!n.partial||Number(n.partial)<=0){alert("Partial payment is required");return}if(!((O=n.status)!=null&&O.trim())){alert("Status is required.");return}const u=Number((h==null?void 0:h.plan_price)||0)-Number(n.rebate||0),p={...n,bill_amount:u,rebate:Number(n.rebate)||0,partial:Number(n.partial)||0};try{console.log("Form data to submityaaaaa:",JSON.stringify(p,null,2));const x=await se.post(`${L}/api/transactions`,p);z(x.data),console.log("Response:",x.data),r(!0),d("rebate",""),d("partial",""),d("remarks",""),d("status",""),ee()}catch(x){console.error("Error creating transaction:",x.response||x),alert("Failed to create transaction. Check console for details.")}},k=["Month","Bill Noww.","Bill Amount","Status"],H=["Acc No.","Customer Name","Status"],C=[{value:"paid",label:"Paid"},{value:"unpaid",label:"Unpaid"}],_=(J==null?void 0:J.data.map(t=>({id:t.id,customer_name:`${t.lastname} ${t.firstname} ${t.middlename??""}`,firstname:t.firstname,middlename:t.middlename,lastname:t.lastname,address:t.address,contact_no:t.contact_no,sex:t.sex,marital_status:t.marital_status,birthdate:t.birthdate,occupation:t.occupation,status:t.status,plans:t.customer_plans.map(u=>{const p=u.transactions.length?[...u.transactions].sort((x,re)=>new Date(re.created_at)-new Date(x.created_at))[0]:null;let D=null,O=null;return p&&(D=Number(p.bill_amount)-Number(p.partial),O=Fe(p.created_at).format("MMMM")),{customer_plan_id:u.id,mbps:u.plan.mbps,plan_price:u.plan.plan_price,date_registration:u.date_registration,latest_balance:u.latest_balance,latest_balance_month:u.latest_balance_month,transactions:u.transactions.map(x=>({id:x.id,bill_no:x.bill_no,rebate:x.rebate,partial:x.partial,bill_amount:x.bill_amount,remarks:x.remarks,status:x.status,created_at:x.created_at})),last_transaction:p,balance:D,balanceMonth:O,collector_id:u.collector_id}})})))||[],M=(b==null?void 0:b.data.map(t=>({id:t.id,customer_name:`${t.lastname} ${t.firstname} ${t.middlename??""}`,firstname:t.firstname,middlename:t.middlename,lastname:t.lastname,address:t.address,contact_no:t.contact_no,sex:t.sex,marital_status:t.marital_status,birthdate:t.birthdate,occupation:t.occupation,status:t.status,plans:t.customer_plans.map(u=>({customer_plan_id:u.id,collector_id:u.collector_id,mbps:u.plan.mbps,plan_price:u.plan.plan_price,date_registration:u.date_registration,transactions:u.transactions.map(p=>({id:p.id,bill_no:p.bill_no,rebate:Number(p.rebate)||0,partial:Number(p.partial)||0,bill_amount:Number(p.bill_amount)||0,remarks:p.remarks,status:p.status,created_at:p.created_at,updated_at:p.updated_at}))}))})))||[];N.useEffect(()=>{S!==null&&alert(`Selected Customer: ${h.customer_name}`)},[S,h]),N.useEffect(()=>{h!=null&&h.customer_plan_id&&d("customer_plan_id",h.customer_plan_id),h!=null&&h.collector_id&&d("collector_id",h.collector_id)},[h]);const U=t=>{const u=t.plans[0]||{};Q(t.id),d("customer_plan_id",u.customer_plan_id),d("collector_id",u.collector_id),B({customer_name:`${t.firstname} ${t.lastname}`,customer_plan_id:u.customer_plan_id,mbps:u.mbps||"N/A",plan_price:u.plan_price||"N/A",date_registration:u.date_registration||"N/A",latest_balance:u.latest_balance||0,latest_balance_month:u.latest_balance_month||"N/A",collector_id:u.collector_id||""}),s(!1)},W=t=>{const u=t.target.value;I(u),d("remarks",u)};return e.jsxs(Ae,{children:[e.jsx(Te,{title:"Create New Bill"}),e.jsxs("div",{className:"bg-white overflow-y-auto max-h-[590px] grid place-justify-center ",children:[e.jsxs("div",{className:"flex justify-between mt-5 mb-2 px-4",children:[e.jsxs("div",{className:"flex gap-10",children:[e.jsx(o.Radio,{name:"type",label:"Advance Billing",value:"advance",checked:A==="advance",onChange:W}),e.jsx(o.Radio,{name:"type",label:"Batch Billing",value:"batch",checked:A==="batch",onChange:W})]}),e.jsx(o.Tooltip,{content:"Back",children:e.jsx(Ce,{href:"/transactions",className:"hover:bg-gray-200 px-2 py-1 rounded",children:e.jsx(ke,{className:"text-xl cursor-pointer"})})})]}),e.jsxs(o.Dialog,{open:l,handler:m,size:"lg",children:[e.jsx(o.DialogHeader,{children:"Billing Notice"}),e.jsx(o.DialogBody,{children:e.jsx("div",{className:"h-[480px] overflow-auto",children:e.jsxs("div",{ref:v,className:"relative  p-6 rounded shadow",children:[e.jsx("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rotate-[-30deg]
                text-green-800 font-bold text-6xl border-2 border-green-800
  px-8 py-4 opacity-40 select-none pointer-events-none
                whitespace-nowrap inline-block`,children:"CFS NOTICE PAID"}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("img",{src:"/img/internet.png",alt:"CFS Logo",className:"w-16 h-16"}),e.jsxs("div",{className:"text-sm mt-1",children:["#2, Manguelod Bldg. National High Way",e.jsx("br",{}),"District II, Tumauini, Isabela",e.jsx("br",{}),"TIN: 295-973-965-001",e.jsx("br",{}),"CP#: 09453367030"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:i!=null&&i.customer?[(ce=i.customer)==null?void 0:ce.firstname,(oe=i.customer)==null?void 0:oe.middlename,(de=i.customer)==null?void 0:de.lastname].filter(Boolean).join(" "):""}),e.jsx("p",{children:(ue=i==null?void 0:i.transaction)!=null&&ue.created_at?Se(new Date(i.transaction.created_at),"MMMM dd, yyyy"):""})]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{children:"Acct. No:"}),e.jsx("span",{children:((he=(me=i==null?void 0:i.transaction)==null?void 0:me.customer_plan)==null?void 0:he.customer_id)??""})]}),e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{children:"Bill No."}),e.jsx("span",{children:((pe=i==null?void 0:i.transaction)==null?void 0:pe.bill_no)??""})]}),e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Bill for the month of August"}),e.jsxs("span",{children:["₱"," ",((be=i==null?void 0:i.transaction)==null?void 0:be.bill_amount)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rebate"}),e.jsxs("span",{children:["₱"," ",((fe=i==null?void 0:i.transaction)==null?void 0:fe.rebate)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Partial"}),e.jsxs("span",{children:["₱"," ",((xe=i==null?void 0:i.transaction)==null?void 0:xe.partial)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Outstanding Balance Previous Month"}),e.jsxs("span",{children:["₱"," ",(i==null?void 0:i.outstanding_balance)??"0.00"]})]}),e.jsxs("div",{className:"flex justify-between font-bold border-t border-gray-400 pt-2",children:[e.jsx("span",{children:"Amount Due:"}),e.jsxs("span",{children:["₱"," ",((ge=i==null?void 0:i.transaction)==null?void 0:ge.bill_amount)??"0.00"]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-4",children:[e.jsx("span",{children:"Prepared by: John"}),e.jsxs("span",{children:["Collector:"," ",i!=null&&i.customer?[(ye=i.collector)==null?void 0:ye.firstname,(je=i.collector)==null?void 0:je.middlename,(_e=i.collector)==null?void 0:_e.lastname].filter(Boolean).join(" "):""]}),e.jsxs("span",{children:["Date:"," ",(Ne=i==null?void 0:i.transaction)!=null&&Ne.created_at?Se(new Date(i.transaction.created_at),"MMMM dd, yyyy"):""]})]}),e.jsxs("div",{className:"border border-red-500 p-3 rounded text-sm bg-red-50 flex items-start gap-2",children:[e.jsx("div",{className:"text-red-600 font-bold",children:"⚠"}),e.jsxs("div",{children:[e.jsx("p",{children:"7 Days Notice: To avoid temporary disconnection kindly settle your bill within 7 days of the due date. For assistance or to make a payment please call:"}),e.jsx("p",{className:"font-bold",children:"CUSTOMER SERVICE NO: 09453367030"}),e.jsx("p",{className:"font-bold",children:"BILLING DEPT. CP NO: 09162832206"})]})]})]})})}),e.jsxs(o.DialogFooter,{children:[e.jsx(o.Button,{variant:"text",color:"red",onClick:m,className:"mr-2",children:"Cancel"}),e.jsx(o.Button,{variant:"gradient",color:"green",onClick:()=>Z(),children:"Print"})]})]}),e.jsxs("div",{className:"flex justify-between items-center px-4",children:[e.jsxs("div",{className:"flex gap-6 px-4",children:[e.jsxs(o.Typography,{variant:"h6",color:"blue-gray",children:["ACC NO.:"," ",e.jsx("span",{className:"text-orange-900",children:S})]}),e.jsxs(o.Typography,{variant:"h6",color:"blue-gray",children:["CUSTOMER:"," ",e.jsxs("span",{className:"text-orange-900",children:[(h==null?void 0:h.customer_name)||"","-- ",(h==null?void 0:h.collector_id)||""]})]}),e.jsxs(o.Typography,{variant:"h6",color:"blue-gray",children:["PLAN:"," ",e.jsx("span",{className:"text-orange-900",children:h&&h.mbps?`${h.mbps} mbps - ${new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(h.plan_price)}`:""})]}),e.jsxs(o.Typography,{variant:"h6",color:"blue-gray",children:["REGISTRATION:"," ",e.jsx("span",{className:"text-orange-900",children:h.date_registration})]}),e.jsxs(o.Typography,{variant:"h6",color:"blue-gray",children:["BALANCE OF ",h.latest_balance_month,":"," ",e.jsx("span",{className:"text-orange-900",children:h.latest_balance})]})]}),e.jsxs("div",{children:[e.jsx(o.Button,{onClick:a,variant:"gradient",children:"New Bill"}),e.jsx(o.Dialog,{open:c,handler:a,children:e.jsx(o.DialogBody,{children:e.jsxs(o.Card,{className:"h-[480px] w-full overflow-scroll",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(o.Typography,{variant:"h6",color:"blue-gray",children:"SEARCH CUSTOMER"}),e.jsx("input",{className:"w-96 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md pl-3 pr-10 py-2 transition duration-300 ease focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow",placeholder:"Search lastname..."})]}),e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsx("tr",{children:H.map(t=>e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:e.jsx(o.Typography,{variant:"small",color:"blue-gray",className:"font-normal leading-none opacity-70",children:t})},t))})}),e.jsx("tbody",{children:F?e.jsx("tr",{children:e.jsx("td",{colSpan:H.length,className:"border border-blue-gray-100 p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(o.Spinner,{className:"h-10 w-10",color:"green"})})})}):_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:k.length,className:"border border-blue-gray-100 p-4 text-center text-red-500",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:["No customer records found",e.jsx(Oe,{className:"text-xl"})]})})}):_.map(t=>{const{id:u,customer_name:p,status:D,plans:O}=t;return e.jsxs("tr",{className:"hover:bg-blue-gray-50 cursor-pointer",onClick:()=>U(t),children:[e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(o.Typography,{variant:"small",className:"font-normal text-gray-800",children:u})}),e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(o.Typography,{variant:"small",className:"font-normal text-gray-800",children:p})}),e.jsx("td",{className:"border border-blue-gray-100 px-4 py-2 ",children:e.jsx(o.Typography,{variant:"small",className:"font-normal text-gray-800",children:D})})]},u)})})]})]})})})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-1",children:[e.jsxs("div",{className:"w-full lg:w-[60%] h-[480px] overflow-auto p-4 border-2 border-sky-500",children:[e.jsx(o.Typography,{variant:"h6",color:"blue-gray",children:"ALL TRANSACTION"}),e.jsxs("table",{className:"w-full min-w-max table-auto text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Month"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Bill No"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Partial"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Total Amount Paid"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Remarks"}),e.jsx("th",{className:"border-b border-blue-gray-100 bg-blue-gray-50 p-4",children:"Status"})]})}),e.jsx("tbody",{children:F?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"border p-4",children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(o.Spinner,{className:"h-10 w-10",color:"green"})})})}):M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"border p-4 text-center text-red-500",children:"No transaction records found"})}):M.map(t=>t.plans.flatMap(u=>u.transactions.map(p=>e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border px-4 py-2",children:new Date(p.created_at).toLocaleDateString("en-US")}),e.jsx("td",{className:"border px-4 py-2",children:p.bill_no}),e.jsx("td",{className:"border px-4 py-2",children:new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(p.partial)}),e.jsx("td",{className:"border px-4 py-2",children:new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(p.bill_amount)}),e.jsx("td",{className:"border px-4 py-2",children:p.remarks}),e.jsx("td",{className:"border px-4 py-2",children:p.status})]},p.id))))})]})]}),e.jsx("div",{className:"w-full lg:w-[35%] p-4 overflow-auto shadow-md rounded-md border-2 border-sky-500",children:e.jsxs("form",{onSubmit:E,children:[e.jsx("input",{type:"hidden",value:n.customer_plan_id,onChange:t=>d("customer_plan_id",t.target.value),className:"mb-2"}),e.jsx("input",{type:"hidden",value:n.collector_id,onChange:t=>d("collector__id",t.target.value),className:"mb-2"}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Acc No."}),e.jsx(o.Input,{size:"md",value:n.customer_plan_id,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill No."}),e.jsx(o.Input,{size:"md",value:n.bill_no,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Bill Amount"}),e.jsx(o.Input,{size:"md",value:h&&h.mbps?h.plan_price:"",disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance Previous Month"}),e.jsx(o.Input,{size:"md",value:h.latest_balance,disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Rebate"}),e.jsx(o.Input,{type:"number",size:"md",value:n.rebate||"",onChange:t=>{const u=Number(t.target.value),p=Number(h.plan_price);u>p?(alert(`Rebate cannot be greater than Plan Price (${p}).`),d("rebate",p)):d("rebate",u)},className:"mb-3",onWheel:t=>t.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Total Amount Due"}),e.jsx(o.Input,{type:"number",size:"md",value:Number(h.plan_price)-Number(n.rebate||0),onChange:t=>d("bill_amount",t.target.value),className:"mb-3",disabled:!0})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Payment"}),e.jsx(o.Input,{type:"number",size:"md",value:n.partial||"",onChange:t=>{const u=Number(t.target.value),p=Number(h.plan_price)-Number(n.rebate||0);u>p?(alert(`Partial cannot be greater than Total Amount Paid (${p}).`),d("partial",p)):d("partial",u)},className:"mb-3",onWheel:t=>t.target.blur()})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Outstanding Balance"}),e.jsx(o.Input,{size:"md",value:Number(n.partial)===Number(h.plan_price)?0:Math.max(0,Number(h.plan_price)-Number(n.rebate||0)-(Number(n.partial||0)+Number(n.bill_amount||0))),disabled:!0,className:"mb-3"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Date Billing"}),e.jsx(o.Input,{size:"md",type:"date",value:n.date_billing,onChange:t=>d("date_billing",t.target.value),error:!!g.date_billing,className:"w-full"})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx(o.Typography,{variant:"paragraph",color:"blue-gray",className:"mb-1 ",children:"Status"}),e.jsx(Be,{options:C,placeholder:"Choose a status",value:C.find(t=>t.value===n.status),onChange:t=>d("status",t?t.value:""),className:"mb-3"})]}),e.jsx(o.Button,{type:"submit",disabled:$,color:"blue",fullWidth:!0,children:"Save"})]})})]})]})]})};export{Qe as default};
