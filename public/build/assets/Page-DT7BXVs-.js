import{a as r,j as e,M as A,r as a,c as P}from"./app-BmcDMkCb.js";import{A as G}from"./AuthenticatedLayout-B2Tgy_RS.js";import{l as L}from"./index-BsfGHC4J.js";const Y=()=>{const[s,C]=r.useState(""),[l,_]=r.useState(new Date().getMonth()+1),[n,T]=r.useState(new Date().getFullYear()),[u,E]=r.useState([]),[o,m]=r.useState(!1),[x,$]=r.useState(""),[i,d]=r.useState(null),[p,h]=r.useState(!1),F=async()=>{if(!s||!l||!n)return alert("Please select all filters!");try{m(!0);const t=await P.get(`http://localhost:8000/api/batch-unpaid/${s}?month=${l}&year=${n}`);E(t.data.transactions||[])}catch(t){console.error("Error fetching unpaid transactions:",t)}finally{m(!1)}},g=r.useRef(),R=L.useReactToPrint({contentRef:g}),k=async()=>{if(!x)return alert("Please select a batch!");try{h(!0),d(null);const t=await P.post(`http://localhost:8000/api/batch-billing/generate/${x}`);setTimeout(()=>{d(t.data),h(!1)},5e3)}catch(t){console.error("Error generating batch:",t),h(!1)}};return r.useEffect(()=>{if(i){const t=setTimeout(()=>{d(null),window.location.reload()},3e3);return()=>clearTimeout(t)}},[i]),e.jsxs(G,{children:[e.jsx(A,{title:"Generate Batch Bill"}),e.jsx("div",{className:"flex justify-end items-center ",children:e.jsx(a.Button,{variant:"gradient",className:"",color:"green",onClick:()=>R(),children:"Print"})}),e.jsxs("div",{className:"flex justify-center flex-col items-center",children:[e.jsx("h1",{className:"text-4xl mt-1 mb-5",children:"Batch Billing Generation"}),e.jsxs("div",{className:"max-w-[800px] mb-2",children:[e.jsxs("h3",{children:["Generate Batch Billing for the month"," ",new Date().toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs(a.Select,{label:"Select Batch",onChange:t=>$(t),children:[e.jsx(a.Option,{value:"1",children:"Batch 1"}),e.jsx(a.Option,{value:"2",children:"Batch 2"}),e.jsx(a.Option,{value:"3",children:"Batch 3"}),e.jsx(a.Option,{value:"4",children:"Batch 4"}),e.jsx(a.Option,{value:"5",children:"Batch 5"}),e.jsx(a.Option,{value:"6",children:"Batch 6 (All Cheque)"})]}),e.jsx(a.Button,{onClick:k,disabled:p,children:p?"Generating...":"Generate"})]})]}),i&&e.jsx("div",{className:"mt-6 p-4 bg-green-200 rounded-md w-full text-center text-green-800",children:e.jsx(a.Typography,{variant:"h6",children:"Batch bill generated successfully."})}),e.jsx("div",{className:"max-w-[920px] w-full border-t border-gray-300 ",children:e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs(a.Select,{label:"Select Batch",onChange:t=>C(t),children:[e.jsx(a.Option,{value:"1",children:"Batch 1"}),e.jsx(a.Option,{value:"2",children:"Batch 2"}),e.jsx(a.Option,{value:"3",children:"Batch 3"}),e.jsx(a.Option,{value:"4",children:"Batch 4"}),e.jsx(a.Option,{value:"5",children:"Batch 5"}),e.jsx(a.Option,{value:"6",children:"Batch 6 (All Cheque)"})]}),e.jsx(a.Input,{type:"number",label:"Month",value:l,onChange:t=>_(t.target.value),min:1,max:12}),e.jsx(a.Input,{type:"number",label:"Year",value:n,onChange:t=>T(t.target.value),min:2e3,max:2100}),e.jsx(a.Button,{onClick:F,disabled:o,children:o?"Fetching...":"Filter"})]})})]}),e.jsx("div",{className:"px-4 mt-5 h-[420px] overflow-auto",children:e.jsxs("div",{ref:g,className:"print:px-2",children:[e.jsxs("h3",{className:"text-lg",children:["Batch",s??"","(",l??"","/",n??""," )"]}),e.jsxs("table",{className:" w-full  text-left border border-gray-300 text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{children:["Bill No.","Customer No.","Customer Name","Address","Batch","Plan Price"].map((t,c)=>e.jsx("th",{className:"px-6 py-3 text-sm font-semibold bg-gray-300 text-gray-700 uppercase border border-gray-400",children:e.jsx(a.Typography,{variant:"small",color:"blue-gray",className:"text-[12px] font-normal leading-none opacity-70",children:t})},c))})}),e.jsx("tbody",{children:u.length>0?u.map(t=>{var c,b,j,f,y,B,v,N,S,w,O;return e.jsxs("tr",{className:"hover:bg-blue-gray-50",children:[e.jsx("td",{className:"border border-blue-gray-100 px-4 ",children:t.bill_no}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:(c=t.customer_plan.customer)==null?void 0:c.id}),e.jsx("td",{className:"border border-blue-gray-100 px-4",children:`${(b=t.customer_plan.customer)==null?void 0:b.firstname} ${(j=t.customer_plan.customer)==null?void 0:j.lastname}`}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:[(B=(y=(f=t.customer_plan.customer)==null?void 0:f.purok)==null?void 0:y.barangay)==null?void 0:B.barangay_name,", ",(w=(S=(N=(v=t.customer_plan.customer)==null?void 0:v.purok)==null?void 0:N.barangay)==null?void 0:S.municipality)==null?void 0:w.municipality_name]}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:["Batch ",s]}),e.jsxs("td",{className:"border border-blue-gray-100 px-4",children:["â‚±",(O=t.customer_plan.plan)==null?void 0:O.plan_price]})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4",children:o?"Fetching data...":"No records found"})})})]})]})})]})};export{Y as default};
